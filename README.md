# 📁 SlideAI 檔案管理系統指南

## 🎯 系統概述

為了因應 Render.com 免費方案的資料庫儲存限制，我們實作了完整的檔案生命週期管理系統，確保系統資源的有效利用。

## 🚀 核心功能

### ✅ 自動檔案清理
- **保留期限**: 7天
- **清理機制**: 每次健康檢查時自動執行
- **清理範圍**: 過期檔案實體檔案和資料庫記錄

### ⏰ 過期提醒系統
- **提醒時間**: 檔案過期前24小時
- **提醒方式**: 彈跳視窗通知
- **提醒內容**: 檔案名稱、剩餘時間

### 📊 檔案管理介面
- **檔案列表**: 顯示所有有效檔案
- **檔案詳情**: 查看檔案資訊和分析結果
- **手動刪除**: 用戶可主動刪除檔案
- **狀態追蹤**: 處理中、已完成、已過期

## 🏗️ 技術架構

### 後端架構
```
models.py
├── User (使用者)
├── UsageRecord (使用記錄)
└── UserFile (檔案記錄)
    ├── file_name: 檔案名稱
    ├── file_path: 檔案路徑
    ├── file_type: 檔案類型
    ├── file_size: 檔案大小
    ├── status: 檔案狀態
    ├── created_at: 建立時間
    ├── expires_at: 過期時間
    └── analysis_result: 分析結果
```

### 前端架構
```
FileManager.vue
├── 檔案統計面板
├── 檔案列表表格
├── 檔案詳情 Modal
└── 過期提醒 Modal
```

## 🔧 配置參數

### 檔案管理設定
```python
FILE_RETENTION_DAYS = 7          # 檔案保留天數
FILE_EXPIRY_WARNING_HOURS = 24   # 過期前警告時間
MAX_FILE_SIZE = 50 * 1024 * 1024 # 最大檔案大小 (50MB)
```

### 檔案類型限制
- **影片摘要**: 50MB 以下
- **PPT轉影片**: 20MB 以下 (PDF)

## 📡 API 端點

### 檔案管理 API
```
GET  /api/user/files              # 獲取用戶檔案列表
GET  /api/user/files/expiring     # 獲取即將過期的檔案
DELETE /api/user/files/{file_id}  # 刪除指定檔案
POST /api/admin/cleanup-files     # 手動清理過期檔案 (管理員)
```

### 檔案處理 API
```
POST /api/video-abstract          # 影片摘要 (已更新)
POST /api/ppt-to-video           # PPT轉影片 (已更新)
```

## 🎨 用戶介面

### 檔案管理頁面 (/files)
- **統計面板**: 總檔案數、即將過期、總大小
- **檔案列表**: 表格形式顯示所有檔案
- **操作按鈕**: 查看詳情、刪除檔案
- **狀態標示**: 顏色區分不同狀態

### 過期提醒
- **自動彈出**: 檢測到即將過期檔案時
- **詳細資訊**: 檔案名稱、剩餘時間
- **警告說明**: 過期後無法恢復

## 🔄 工作流程

### 檔案上傳流程
1. 用戶上傳檔案
2. 系統檢查檔案大小和類型
3. 創建檔案記錄 (包含過期時間)
4. 執行 AI 分析
5. 更新檔案狀態為 "已完成"
6. 返回分析結果和檔案資訊

### 檔案清理流程
1. 系統定期檢查過期檔案
2. 刪除實體檔案
3. 更新資料庫狀態為 "已過期"
4. 記錄清理日誌

### 過期提醒流程
1. 系統檢查即將過期的檔案
2. 向前端發送提醒資訊
3. 前端顯示彈跳視窗
4. 用戶確認提醒

## 🛡️ 安全機制

### 檔案安全
- **唯一檔案名**: 使用 UUID 避免衝突
- **路徑驗證**: 防止路徑遍歷攻擊
- **權限檢查**: 只能操作自己的檔案

### 資料安全
- **自動備份**: 重要資料定期備份
- **錯誤處理**: 完善的異常處理機制
- **日誌記錄**: 記錄所有重要操作

## 📈 效能優化

### 儲存優化
- **自動清理**: 避免儲存空間浪費
- **檔案壓縮**: 可選的檔案壓縮功能
- **分層儲存**: 熱資料和冷資料分離

### 查詢優化
- **索引優化**: 資料庫索引設計
- **分頁查詢**: 大量資料分頁顯示
- **快取機制**: 常用資料快取

## 🚨 故障排除

### 常見問題

**Q: 檔案沒有自動清理？**
A: 檢查健康檢查端點是否正常執行，確認資料庫連接正常。

**Q: 過期提醒沒有顯示？**
A: 檢查前端 JavaScript 是否正常載入，確認 API 端點可訪問。

**Q: 檔案上傳失敗？**
A: 檢查檔案大小是否超過限制，確認檔案類型是否支援。

**Q: 檔案記錄不正確？**
A: 檢查資料庫連接，確認 UserFile 表結構正確。

### 除錯方法
1. **檢查日誌**: 查看後端服務日誌
2. **API 測試**: 使用 curl 或 Postman 測試 API
3. **資料庫檢查**: 直接查詢資料庫記錄
4. **前端除錯**: 使用瀏覽器開發者工具

## 🔮 未來擴展

### 計劃功能
- **檔案分享**: 用戶間檔案分享
- **版本控制**: 檔案版本管理
- **批量操作**: 批量刪除、下載
- **雲端儲存**: 整合外部雲端儲存
- **檔案預覽**: 線上檔案預覽功能

### 效能提升
- **非同步處理**: 檔案處理非同步化
- **CDN 整合**: 檔案分發網路
- **壓縮優化**: 更高效的檔案壓縮
- **快取策略**: 多層快取機制

## 📞 技術支援

### 開發環境
- **後端**: FastAPI + PostgreSQL
- **前端**: Vue.js + Bootstrap
- **部署**: Render.com + GitHub Pages

### 聯絡方式
- **問題回報**: GitHub Issues
- **功能建議**: GitHub Discussions
- **技術文件**: 專案 Wiki

---

**注意**: 此系統專為 Render.com 免費方案設計，確保在有限資源下提供最佳用戶體驗。 